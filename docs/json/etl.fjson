{"parents": [], "prev": {"link": "../cookbook/", "title": "Cheat Sheet"}, "next": {"link": "../local_development/", "title": "Local Development Setup"}, "title": "ETL with cartoframes", "meta": null, "body": "<div class=\"section\" id=\"etl-with-cartoframes\">\n<h1>ETL with cartoframes<a class=\"headerlink\" href=\"#etl-with-cartoframes\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>One common use case for cartoframes is its use in an ETL (Extract, Transform, and Load) process. The most common pattern is to load the data into CARTO:</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">cartoframes.auth</span> <span class=\"k\">import</span> <span class=\"n\">Credentials</span>\n<span class=\"kn\">from</span> <span class=\"nn\">cartoframes.data</span> <span class=\"k\">import</span> <span class=\"n\">Dataset</span>\n\n<span class=\"n\">credentials</span> <span class=\"o\">=</span> <span class=\"n\">Credentials</span><span class=\"p\">(</span><span class=\"n\">username</span><span class=\"o\">=</span><span class=\"s1\">&#39;&lt;USER NAME&gt;&#39;</span><span class=\"p\">,</span> <span class=\"n\">api_key</span><span class=\"o\">=</span><span class=\"s1\">&#39;&lt;API KEY&gt;&#39;</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Extract into a pandas&#39; DataFrame (can be replaced by other operation)</span>\n<span class=\"n\">raw_data</span> <span class=\"o\">=</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">read_csv</span><span class=\"p\">(</span><span class=\"s1\">&#39;https://&lt;remote location&gt;.csv&#39;</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Transform</span>\n<span class=\"n\">processed_data</span> <span class=\"o\">=</span> <span class=\"o\">&lt;</span><span class=\"n\">some</span> <span class=\"n\">processing</span> <span class=\"n\">pipeline</span><span class=\"o\">&gt;</span>\n\n<span class=\"c1\"># Load into your carto account</span>\n<span class=\"n\">Dataset</span><span class=\"p\">(</span><span class=\"n\">processed_data</span><span class=\"p\">,</span> <span class=\"n\">credentials</span><span class=\"o\">=</span><span class=\"n\">credentials</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">upload</span><span class=\"p\">(</span><span class=\"n\">table_name</span><span class=\"o\">=</span><span class=\"s1\">&#39;processed_data&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"section\" id=\"read-data-from-postgresql-to-carto\">\n<h2>Read data from PostgreSQL to CARTO<a class=\"headerlink\" href=\"#read-data-from-postgresql-to-carto\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">from</span> <span class=\"nn\">cartoframes.auth</span> <span class=\"k\">import</span> <span class=\"n\">Credentials</span>\n<span class=\"kn\">from</span> <span class=\"nn\">cartoframes.data</span> <span class=\"k\">import</span> <span class=\"n\">Dataset</span>\n\n<span class=\"n\">credentials</span> <span class=\"o\">=</span> <span class=\"n\">Credentials</span><span class=\"p\">(</span><span class=\"n\">username</span><span class=\"o\">=</span><span class=\"s1\">&#39;&lt;USER NAME&gt;&#39;</span><span class=\"p\">,</span> <span class=\"n\">api_key</span><span class=\"o\">=</span><span class=\"s1\">&#39;&lt;API KEY&gt;&#39;</span><span class=\"p\">)</span>\n\n<span class=\"kn\">import</span> <span class=\"nn\">pandas</span> <span class=\"k\">as</span> <span class=\"nn\">pd</span>\n<span class=\"kn\">import</span> <span class=\"nn\">sqlalchemy</span> <span class=\"k\">as</span> <span class=\"nn\">sql</span>\n\n<span class=\"n\">connection_string</span> <span class=\"o\">=</span> <span class=\"s1\">&#39;postgresql://localhost:5432&#39;</span>  <span class=\"c1\"># replace with your connection string</span>\n<span class=\"n\">engine</span> <span class=\"o\">=</span> <span class=\"n\">sql</span><span class=\"o\">.</span><span class=\"n\">create_engine</span><span class=\"p\">(</span><span class=\"n\">connect_string</span><span class=\"p\">)</span>\n<span class=\"n\">raw_data</span> <span class=\"o\">=</span> <span class=\"n\">pd</span><span class=\"o\">.</span><span class=\"n\">read_sql_query</span><span class=\"p\">(</span><span class=\"s1\">&#39;arbitrary sql query&#39;</span><span class=\"p\">,</span> <span class=\"n\">con</span><span class=\"o\">=</span><span class=\"n\">engine</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># do something with this data</span>\n<span class=\"c1\"># for example, create a map from the dataframe with lat/lng columns</span>\n<span class=\"n\">Map</span><span class=\"p\">(</span><span class=\"n\">Layer</span><span class=\"p\">(</span><span class=\"n\">raw_data</span><span class=\"p\">))</span>\n\n<span class=\"c1\"># send to carto</span>\n<span class=\"n\">pg_dataset</span> <span class=\"o\">=</span> <span class=\"n\">Dataset</span><span class=\"p\">(</span><span class=\"n\">df</span><span class=\"p\">)</span>\n<span class=\"n\">pg_dataset</span><span class=\"o\">.</span><span class=\"n\">upload</span><span class=\"p\">(</span><span class=\"n\">table_name</span><span class=\"o\">=</span><span class=\"s1\">&#39;table_from_pg_db&#39;</span><span class=\"p\">,</span> <span class=\"n\">credentials</span><span class=\"o\">=</span><span class=\"n\">credentials</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n</div>\n<div class=\"section\" id=\"use-cases\">\n<h2>Use cases<a class=\"headerlink\" href=\"#use-cases\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<ul class=\"simple\">\n<li><p>Syncing datasets that aren\u2019t accessible to the Import API\u2019s sync option or that need intermediate processing</p></li>\n<li><p>Connecting datasets that reside in datalakes to CARTO</p></li>\n<li><p>Subsampling large datasets for preview in CARTO</p></li>\n</ul>\n</div>\n<div class=\"section\" id=\"examples\">\n<h2>Examples<a class=\"headerlink\" href=\"#examples\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<ul class=\"simple\">\n<li><p><a class=\"reference external\" href=\"https://github.com/andy-esch/hive-carto-connector\">Hive -&gt; CARTO connector</a></p></li>\n<li><p><a class=\"reference external\" href=\"https://city-informatics.com/cartoframes-dashboard-tutorial/\">Accessing and parsing a live data feed</a></p></li>\n<li><p><a class=\"reference external\" href=\"https://github.com/jhaddadin/massoutagemap\">Live Power Outage reporting for Massachusetts</a></p></li>\n</ul>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"], ["local_development", "Local Development Setup", "N", "next"], ["cookbook", "Cheat Sheet", "P", "previous"]], "sourcename": "etl.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">ETL with cartoframes</a><ul>\n<li><a class=\"reference internal\" href=\"#read-data-from-postgresql-to-carto\">Read data from PostgreSQL to CARTO</a></li>\n<li><a class=\"reference internal\" href=\"#use-cases\">Use cases</a></li>\n<li><a class=\"reference internal\" href=\"#examples\">Examples</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "etl", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}